<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeArena - Focused Practice</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* * ==============================================
         * 1. CSS VARIABLES (THEME: Cozy Study / Blue & Gold)
         * ==============================================
         */
        :root {
            --font-family: 'Inter', sans-serif;
            --title-font-family: 'Playfair Display', serif;
            
            /* --- COZY STUDY COLORS --- */
            --primary-blue: #436b95; /* Main Accent */
            --accent-gold: #caa855; /* Highlight Accent */
            --dark-text: #2b2f36;

            /* Light Mode */
            --bg-primary-light: #f7f9fb;      /* Page background (soft gradient start) */
            --bg-secondary-light: #ffffff;      /* Card/Navbar background */
            --bg-tertiary-light: #e7eef4;      /* Input/Hover background (light slate blue) */
            --text-primary-light: var(--dark-text);     /* Body text */
            --text-secondary-light: #59626d;    /* Muted text */
            --text-muted-light: #868e96;        /* More muted text */
            --border-color-light: #d0d7de;      /* Softer Borders */
            --shadow-color-light: rgba(0, 0, 0, 0.05);
            --editor-bg-light: #fdfdfd;
            --editor-text-light: #333;
            --editor-gutter-light: #f0f4f9;

            /* Dark Mode */
            --bg-primary-dark: #121212;         /* Page background */
            --bg-secondary-dark: #1f2937;        /* Card/Navbar background */
            --bg-tertiary-dark: #374151;         /* Input/Hover background */
            --text-primary-dark: #e5e7eb;       /* Body text */
            --text-secondary-dark: #a0a0a0;     /* Muted text */
            --text-muted-dark: #707070;         /* More muted text */
            --border-color-dark: #374151;       /* Borders */
            --shadow-color-dark: rgba(0, 0, 0, 0.4);
            --editor-bg-dark: #1e293b;
            --editor-text-dark: #e5e7eb;
            --editor-gutter-dark: #334155;
            
            /* Accent Colors (Based on new scheme) */
            --accent-primary: var(--primary-blue);           /* Deep Blue */
            --accent-primary-hover: #33587e;
            --accent-primary-light: rgba(67, 107, 149, 0.2); /* Light Blue for focus ring */
            --accent-highlight: var(--accent-gold);          /* Gold Accent */
            
            /* Difficulty Colors (Standardized) */
            --difficulty-easy: #4caf50; /* Green */
            --difficulty-easy-bg: #e8f5e9;
            --difficulty-easy-bg-dark: #1c2e22;
            
            --difficulty-medium: #ff9800; /* Orange */
            --difficulty-medium-bg: #fff3e0;
            --difficulty-medium-bg-dark: #3a2a1a;

            --difficulty-hard: #f44336; /* Red */
            --difficulty-hard-bg: #ffebee;
            --difficulty-hard-bg-dark: #3a1e1d;

            /* Sizing & Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 3px var(--shadow-color);
            --shadow-md: 0 5px 15px var(--shadow-color), 0 2px 5px var(--shadow-color);
            
            /* Transitions */
            --transition-fast: all 0.2s ease-out;
            --transition-color: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* Apply themes via data attribute */
        body[data-theme="light"] {
            --bg-primary: var(--bg-primary-light);
            --bg-secondary: var(--bg-secondary-light);
            --bg-tertiary: var(--bg-tertiary-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --text-muted: var(--text-muted-light);
            --border-color: var(--border-color-light);
            --shadow-color: var(--shadow-color-light);
            --editor-bg: var(--editor-bg-light);
            --editor-text: var(--editor-text-light);
            --editor-gutter-bg: var(--editor-gutter-light);
            --diff-easy-bg: var(--difficulty-easy-bg);
            --diff-medium-bg: var(--difficulty-medium-bg);
            --diff-hard-bg: var(--difficulty-hard-bg);
        }

        body[data-theme="dark"] {
            --bg-primary: var(--bg-primary-dark);
            --bg-secondary: var(--bg-secondary-dark);
            --bg-tertiary: var(--bg-tertiary-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --text-muted: var(--text-muted-dark);
            --border-color: var(--border-color-dark);
            --shadow-color: var(--shadow-color-dark);
            --editor-bg: var(--editor-bg-dark);
            --editor-text: var(--editor-text-dark);
            --editor-gutter-bg: var(--editor-gutter-dark);
            --diff-easy-bg: var(--difficulty-easy-bg-dark);
            --diff-medium-bg: var(--difficulty-medium-bg-dark);
            --diff-hard-bg: var(--difficulty-hard-bg-dark);
        }
        
        /* * ==============================================
         * 2. BASE & RESET STYLES
         * ==============================================
         */
        
        /* Keyframe for subtle background animation */
        @keyframes slow-pan {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            transition: var(--transition-color);
            position: relative; /* Needed for the ::before animation */
        }
        
        /* --- Subtle Animated Background Effect --- */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.15; /* Subtle opacity for light mode */
            /* Two soft radial lights that shift slowly */
            background: radial-gradient(circle at 10% 90%, var(--accent-primary-light) 0%, transparent 50%),
                        radial-gradient(circle at 90% 10%, var(--accent-highlight) 0%, transparent 50%);
            background-size: 80% 80%;
            animation: slow-pan 30s linear infinite alternate; /* Slow, repeating animation */
        }

        body[data-theme="dark"]::before {
            opacity: 0.1; /* Even more subtle in dark mode */
            background: radial-gradient(circle at 10% 90%, var(--accent-primary) 0%, transparent 50%),
                        radial-gradient(circle at 90% 10%, var(--accent-highlight) 0%, transparent 50%);
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .problem-description h1 {
            font-family: var(--title-font-family);
            font-weight: 700;
        }

        p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        a {
            color: var(--accent-primary);
            text-decoration: none;
            transition: var(--transition-fast);
        }
        a:hover {
            color: var(--accent-primary-hover);
            text-decoration: underline;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background-color: var(--text-muted); border-radius: var(--radius-md); }
        ::-webkit-scrollbar-thumb:hover { background-color: var(--text-secondary); }
        ::-webkit-scrollbar-track { background-color: transparent; }
        
        /* Icon style */
        i.ph {
            font-size: 1.25rem;
            line-height: 1;
        }

        /* * ==============================================
         * 3. LAYOUT (NAVBAR & MAIN)
         * ==============================================
         */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1.5rem;
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            transition: var(--transition-color);
            box-shadow: var(--shadow-sm);
            z-index: 100;
        }
        
        .nav-left {
            font-family: var(--title-font-family); /* Use Playfair for Logo text */
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-blue);
            letter-spacing: -0.5px;
        }
        .nav-left i {
            color: var(--accent-highlight); /* Gold icon */
            vertical-align: middle;
            font-size: 1.8rem;
            margin-right: 0.25rem;
        }

        .nav-center {
            display: flex;
            gap: 1rem;
        }
        .nav-center a {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
            text-decoration: none;
        }
        .nav-center a.active, .nav-center a:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .theme-toggle {
            width: 36px; height: 36px;
            border: none;
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: 1.1rem;
            display: flex; align-items: center; justify-content: center;
        }
        .theme-toggle:hover {
            background-color: var(--border-color);
            color: var(--text-primary);
        }
        .theme-toggle .ph-sun { display: none; }
        body[data-theme="dark"] .theme-toggle .ph-sun { display: block; }
        body[data-theme="dark"] .theme-toggle .ph-moon { display: none; }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--bg-tertiary);
            border: 2px solid var(--accent-highlight); /* Use Gold accent border */
            cursor: pointer;
            object-fit: cover;
        }

        /* Main 3-Column Layout */
        .main-container {
            display: grid;
            grid-template-columns: 320px 1fr 300px;
            gap: 1rem;
            padding: 1rem;
            flex-grow: 1;
            overflow: hidden;
            height: calc(100vh - 61px);
        }

        /* Base styles for all 3 panels */
        .panel {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: var(--transition-color);
            box-shadow: var(--shadow-sm);
        }

        /* * ==============================================
         * 4. LEFT SIDEBAR (PROBLEM LIST)
         * ==============================================
         */
        .sidebar-left {
            padding: 1rem;
        }

        .problem-filter {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        
        .search-bar {
            width: 100%;
            padding: 0.6rem 0.75rem;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
            background-color: var(--bg-tertiary); /* Use tertiary for input background */
            border-radius: var(--radius-md);
            color: var(--text-primary);
            transition: var(--transition-fast);
        }
        .search-bar:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-primary-light);
            background-color: var(--bg-secondary);
        }

        .filter-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        .filter-buttons .btn-filter {
            padding: 0.5rem;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        .filter-buttons .btn-filter:hover,
        .filter-buttons .btn-filter.active {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        .filter-buttons .btn-filter.active {
            font-weight: 600;
        }

        .problem-list {
            flex-grow: 1;
            overflow-y: auto;
            margin-right: -0.5rem;
            padding-right: 0.5rem;
        }

        .problem-card {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition-fast);
            background-color: var(--bg-secondary); /* Cards are secondary background */
            box-shadow: var(--shadow-sm);
        }
        .problem-card:hover {
            background-color: var(--bg-tertiary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .problem-card.selected {
            border-color: var(--accent-highlight); /* Gold border for selected */
            background-color: var(--bg-tertiary);
            box-shadow: 0 0 0 3px var(--accent-primary-light);
        }

        .problem-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .problem-card-header h3 {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .problem-status {
            font-size: 1.1rem;
            opacity: 0.5;
        }
        .problem-status.solved {
            color: var(--difficulty-easy);
            opacity: 1;
        }

        .problem-card-footer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .difficulty-badge {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: var(--radius-lg);
            text-transform: capitalize;
        }
        .difficulty-easy { color: var(--difficulty-easy); background-color: var(--diff-easy-bg); }
        .difficulty-medium { color: var(--difficulty-medium); background-color: var(--diff-medium-bg); }
        .difficulty-hard { color: var(--difficulty-hard); background-color: var(--diff-hard-bg); }

        .problem-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-left: 0.25rem;
        }
        .tag {
            font-size: 0.7rem;
            font-weight: 500;
            padding: 0.1rem 0.3rem; /* Slightly smaller padding */
            border-radius: var(--radius-sm);
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
        }
        body[data-theme="dark"] .problem-card .tag {
            background-color: var(--bg-tertiary);
        }

        /* * ==============================================
         * 5. MAIN CONTENT (PROBLEM & EDITOR)
         * ==============================================
         */
        .content-main {
            display: flex;
            flex-direction: column;
        }
        
        .problem-description {
            padding: 1.5rem 2rem;
            overflow-y: auto;
            flex-shrink: 0;
            max-height: 40%;
            border-bottom: 1px solid var(--border-color);
        }
        .problem-description h1 {
            font-size: 1.6rem;
            margin-bottom: 0.75rem;
        }
        .problem-tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .problem-tags-list .tag {
            font-size: 0.8rem;
            padding: 0.25rem 0.6rem;
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        
        .problem-description p { margin-bottom: 1rem; font-size: 0.95rem; }
        .problem-description p strong { font-weight: 600; color: var(--text-primary); }
        
        /* Markdown-style code block for examples */
        .problem-description pre {
            background-color: var(--editor-gutter-bg); /* Use the gutter color for code blocks */
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: var(--radius-md);
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            overflow-x: auto;
            color: var(--text-primary);
        }
        .problem-description code {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-tertiary);
            padding: 0.1rem 0.3rem;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            color: var(--text-primary);
        }
        .problem-description pre code {
            background-color: transparent;
            padding: 0;
            border-radius: 0;
            font-size: inherit;
        }

        /* --- Editor Area --- */
        .editor-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .editor-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            background-color: var(--bg-primary); /* Use primary for toolbar background */
        }
        
        select.language-select {
            font-size: 0.9rem;
            font-weight: 500;
            font-family: var(--font-family);
            padding: 0.4rem 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        select.language-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-primary-light);
        }

        .editor-buttons {
            display: flex;
            gap: 0.75rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
        }
        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .btn-secondary:hover {
            background-color: var(--bg-tertiary);
        }
        
        .btn-primary {
            background-color: var(--accent-primary);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--accent-primary-hover);
        }
        
        /* Loading spinner for buttons */
        .btn .spinner {
            display: none;
            width: 16px; height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .btn-secondary .spinner {
            border-color: rgba(0, 0, 0, 0.2);
            border-top-color: var(--text-secondary);
        }
        .btn.loading .spinner { display: block; }
        .btn.loading .btn-text { display: none; }
        
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- Simulated Code Editor --- */
        .code-editor-wrapper {
            flex-grow: 1;
            display: flex;
            overflow: hidden;
            background-color: var(--editor-bg);
        }
        
        .line-numbers {
            flex-shrink: 0;
            padding: 1rem 0.75rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.95rem;
            line-height: 1.5;
            text-align: right;
            color: var(--text-muted);
            background-color: var(--editor-gutter-bg);
            user-select: none;
            overflow-y: hidden;
        }
        .line-numbers span {
            display: block;
            counter-increment: line;
        }
        .line-numbers span::before {
            content: counter(line);
        }
        
        textarea.code-editor {
            flex-grow: 1;
            border: none;
            outline: none;
            padding: 1rem;
            background-color: var(--editor-bg);
            color: var(--editor-text);
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.95rem;
            line-height: 1.5;
            resize: none;
            transition: var(--transition-color);
        }

        /* --- Console Panel --- */
        .console-container {
            flex-shrink: 0;
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-primary);
        }
        .console-header {
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }
        .console-header:hover {
            color: var(--text-primary);
        }
        .console-header i {
            transition: transform 0.2s ease;
        }
        .console-content.collapsed + .console-header i {
            transform: rotate(-90deg);
        }

        .console-content {
            height: 150px;
            padding: 1rem;
            background-color: var(--editor-bg);
            color: var(--text-secondary);
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            overflow-y: auto;
            transition: height 0.3s ease, padding 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }
        .console-content.collapsed {
            height: 0;
            padding-top: 0;
            padding-bottom: 0;
            opacity: 0;
            overflow: hidden;
        }
        .console-content .output-line.error { color: var(--difficulty-hard); }
        .console-content .output-line.success { color: var(--difficulty-easy); }

        /* * ==============================================
         * 6. RIGHT SIDEBAR (PROGRESS)
         * ==============================================
         */
        .sidebar-right {
            padding: 1.5rem 1rem;
            overflow-y: auto;
        }

        .stats-card {
            background-color: var(--bg-tertiary); /* Lighter background for stat cards */
            border-radius: var(--radius-lg);
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }
        .stats-card h3 {
            font-family: var(--title-font-family);
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        /* --- PROFILE CARD STYLES (in sidebar) --- */
        .profile-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
        }
        .profile-img-container {
            position: relative;
            width: 80px;
            height: 80px;
            margin-bottom: 0.75rem;
        }
        .profile-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid var(--accent-highlight);
            object-fit: cover;
        }
        .profile-status-dot {
            position: absolute;
            bottom: 3px;
            right: 3px;
            width: 15px;
            height: 15px;
            background-color: var(--difficulty-easy); /* Green for Online */
            border-radius: 50%;
            border: 3px solid var(--bg-secondary);
        }
        .profile-name {
            font-family: var(--title-font-family);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
            margin-bottom: 0.25rem;
        }
        .profile-email {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        .profile-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            width: 100%;
            margin-bottom: 1rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }
        .stat-detail .value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        .stat-detail .label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        /* --- END PROFILE CARD STYLES --- */

        /* Streak Progress */
        .streak-info {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .streak-days {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-highlight); /* Use Gold for streak number */
            line-height: 1;
        }
        .streak-days span {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-left: 0.25rem;
        }

        .progress-bar {
            width: 100%; height: 8px;
            background-color: var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        .progress-bar-inner {
            height: 100%;
            width: 60%;
            background-color: var(--accent-primary);
            border-radius: var(--radius-lg);
            transition: width 0.5s ease;
        }

        /* Summary Stats (Kept for the second stat card, slightly different styling here) */
        .summary-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .stat-item { display: flex; flex-direction: column; }
        .stat-item .value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        .stat-item .label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Mini Chart */
        .chart-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 100px;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            margin-top: 1rem;
        }
        .chart-bar {
            width: 15px;
            background-color: var(--border-color);
            border-radius: var(--radius-sm);
            position: relative;
            transition: height 0.5s ease-out;
            cursor: pointer;
        }
        .chart-bar:hover { background-color: var(--accent-primary-light); }
        .chart-bar:hover .bar-fill { background-color: var(--accent-primary); }
        
        .bar-fill {
            position: absolute; bottom: 0; left: 0; right: 0;
            background-color: var(--accent-primary);
            border-radius: var(--radius-sm);
            transition: height 0.5s ease-out;
        }
        .bar-label {
            position: absolute; bottom: -20px;
            left: 50%; transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* * ==============================================
         * 7. TOAST NOTIFICATION
         * ==============================================
         */
        .toast {
            position: fixed;
            bottom: 20px; left: 50%;
            transform: translate(-50%, 100px);
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-blue);
            color: white;
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-size: 0.9rem; font-weight: 500;
            opacity: 0;
            transition: transform 0.4s ease, opacity 0.4s ease;
            z-index: 1000;
            user-select: none;
        }
        .toast.show { transform: translate(-50%, 0); opacity: 1; }
        .toast.success { background-color: var(--difficulty-easy); }
        .toast.error { background-color: var(--difficulty-hard); }

        /* * ==============================================
         * 8. MODAL STYLES (New Profile Popup)
         * ==============================================
         */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            z-index: 1000;
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
            opacity: 1;
        }

        .profile-modal {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-md);
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            position: relative;
            padding: 2rem;
        }

        .modal-overlay.show .profile-modal {
            transform: scale(1);
            opacity: 1;
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.5rem;
            line-height: 1;
            transition: var(--transition-fast);
            z-index: 10;
        }
        .modal-close-btn:hover {
            color: var(--difficulty-hard);
        }
        
        /* Modal Content Containers */
        .profile-view {
            display: block; /* Default view */
            transition: opacity 0.2s ease;
        }
        .edit-view {
            display: none; /* Hidden by default */
            transition: opacity 0.2s ease;
        }
        
        /* Active State for Edit Mode - Shows Edit View, hides Profile View */
        .profile-modal.edit-mode .profile-view {
            display: none;
        }

        .profile-modal.edit-mode .edit-view {
            display: block;
        }
        
        .modal-content-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-content-header .profile-name {
            font-size: 2rem;
        }
        
        .modal-detail-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .modal-detail-list li {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        .modal-detail-list li i {
            color: var(--accent-highlight);
        }
        .modal-detail-list li .detail-label {
            font-weight: 600;
            color: var(--text-primary);
        }
        .modal-detail-list li .detail-value {
            margin-left: auto;
            color: var(--text-secondary);
            font-weight: 500; /* Added font weight for detail values */
        }
        
        /* Edit Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.4rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.6rem 0.75rem;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            transition: var(--transition-fast);
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-primary-light);
            background-color: var(--bg-secondary);
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        /* Fix modal scrolling */
        .edit-view {
            padding-top: 0; /* No extra padding here as it's full screen inside modal */
        }
        .profile-modal h2.edit-title {
            font-size: 1.5rem;
            font-family: var(--title-font-family);
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }


        /* * ==============================================
         * 9. RESPONSIVENESS
         * ==============================================
         */
        @media (max-width: 1200px) {
            .main-container { grid-template-columns: 280px 1fr; }
            .sidebar-right { display: none; }
            .problem-description { padding: 1.5rem; }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: 0.5rem;
                gap: 0.5rem;
            }
            .sidebar-left { display: none; }
            .nav-center { display: none; }
            .navbar { padding: 0.75rem 1rem; }
            .content-main { border-radius: var(--radius-md); }
            .problem-description {
                padding: 1rem;
                max-height: 50vh;
            }
            .editor-toolbar { padding: 0.5rem 0.75rem; }
            .btn { padding: 0.5rem 0.75rem; font-size: 0.8rem; }
            .console-content { height: 100px; }
            
            /* Modal on mobile */
            .profile-modal {
                padding: 1rem;
            }
            .modal-content-header .profile-name {
                font-size: 1.5rem;
            }
        }

    </style>
</head>
<body data-theme="light">
    <!-- Removed unnecessary external JS script tag -->
    <nav class="navbar">
        <div class="nav-left">
            <i class="ph-fill ph-code-block"></i>
            AlgoVault
        </div>
        <div class="nav-center">
            <a href="MN Practice.html" class="active">Problems</a>
            <a href="D:\The Create\MN LeaderBorad.html">Leaderboard</a>
            <a href="D:\The Create\MN Discuss.html">Discuss</a>
            <a href="#">Settings</a>
        </div>
        <div class="nav-right">
            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
                <i class="ph ph-moon"></i>
                <i class="ph ph-sun"></i>
            </button>
            <img src="https://placehold.co/36x36/caa855/ffffff?text=U" alt="User Avatar" class="user-avatar" id="nav-user-avatar">
        </div>
    </nav>

    <!-- 
      * ==============================================
      * B. MAIN 3-COLUMN LAYOUT
      * ==============================================
    -->
    <main class="main-container">

        <!-- 
          * --------------------------------------------
          * C. LEFT SIDEBAR (PROBLEM LIST)
          * --------------------------------------------
        -->
        <aside class="panel sidebar-left">
            <div class="problem-filter">
                <input type="search" class="search-bar" placeholder="Search problems...">
                <div class="filter-buttons">
                    <button class="btn-filter active">All</button>
                    <button class="btn-filter">Easy</button>
                    <button class="btn-filter">Medium</button>
                    <button class="btn-filter">Hard</button>
                </div>
            </div>

            <div class="problem-list" id="problem-list">
                <!-- Problems will be generated here by JavaScript -->
                <p style="padding: 1rem; color: var(--text-muted);">Loading problems...</p>
            </div>
        </aside>

        <!-- 
          * --------------------------------------------
          * D. MAIN CONTENT (PROBLEM & EDITOR)
          * --------------------------------------------
        -->
        <main class="panel content-main">
            <!-- Problem Description Area -->
            <div class="problem-description">
                <h1>1. Two Sum</h1>
                <div class="problem-tags-list">
                    <span class="tag">Array</span>
                    <span class="tag">Hash Table</span>
                </div>
                <p>Given an array of integers <code>nums</code> and an integer <code>target</code>, return <em>indices of the two numbers such that they add up to <code>target</code></em>.</p>
                <p>You may assume that each input would have <strong>exactly one solution</strong>, and you may not use the <em>same</em> element twice.</p>
                <p>You can return the answer in any order.</p>

                <p><strong>Example 1:</strong></p>
                <pre>
<strong>Input:</strong> nums = [2,7,11,15], target = 9
<strong>Output:</strong> [0,1]
<strong>Explanation:</strong> Because nums[0] + nums[1] == 9, we return [0, 1].
</pre>
                
                <p><strong>Example 2:</strong></p>
                <pre>
<strong>Input:</strong> nums = [3,2,4], target = 6
<strong>Output:</strong> [1,2]
</pre>
            </div>

            <!-- Editor & Console Area -->
            <div class="editor-area">
                <div class="editor-toolbar">
                    <select class="language-select" id="language-select">
                        <option value="python">Python 3</option>
                        <option value="javascript">JavaScript</option>
                        <option value="cpp">C++</option>
                        <option value="java">Java</option>
                    </select>
                    <div class="editor-buttons">
                        <button class="btn btn-secondary" id="run-btn">
                            <span class="spinner"></span>
                            <i class="ph ph-play"></i>
                            <span class="btn-text">Run</span>
                        </button>
                        <button class="btn btn-primary" id="submit-btn">
                            <span class="spinner"></span>
                            <i class="ph ph-paper-plane-tilt"></i>
                            <span class="btn-text">Submit</span>
                        </button>
                    </div>
                </div>

                <!-- Simulated Code Editor with Line Numbers -->
                <div class="code-editor-wrapper">
                    <div class="line-numbers" id="line-numbers">
                        <!-- Lines generated by JS -->
                    </div>
                    <textarea class="code-editor" id="code-editor" wrap="off" spellcheck="false">
def twoSum(nums, target):
    seen = {}
    for i, num in enumerate(nums):
        complement = target - num
        if complement in seen:
            return [seen[complement], i]
        seen[num] = i
    return []

</textarea>
                </div>
                
                <!-- Console -->
                <div class="console-container">
                    <div class="console-header" id="console-header">
                        <span>Console</span>
                        <i class="ph ph-caret-down"></i>
                    </div>
                    <div class="console-content collapsed" id="console-content">
                        <!-- Output will be injected here -->
                    </div>
                </div>
            </div>
        </main>
        
        <!-- 
          * --------------------------------------------
          * E. RIGHT SIDEBAR (PROGRESS)
          * --------------------------------------------
        -->
        <aside class="panel sidebar-right">
            
            <!-- NEW: Profile Card -->
            <div class="profile-card" id="sidebar-profile-card">
                <div class="profile-img-container">
                    <img src="https://placehold.co/80x80/436b95/ffffff?text=MS" alt="User Profile Picture" class="profile-img" id="profile-img">
                    <span class="profile-status-dot"></span>
                </div>
                <h2 class="profile-name" id="profile-name">Manthan Savaj</h2> 
                <p class="profile-email" id="profile-email">m.vinzuda@gmail.com</p>

                <div class="profile-stats-grid">
                    <div class="stat-detail">
                        <span class="value" id="total-solved">42</span>
                        <span class="label">Solved</span>
                    </div>
                    <div class="stat-detail">
                        <span class="value" id="total-problems">150</span>
                        <span class="label">Total Problems</span>
                    </div>
                </div>

                <button class="btn btn-primary" style="width: 100%;" id="view-profile-btn">
                    <i class="ph ph-user-circle"></i>
                    View More Details
                </button>
            </div>


            <div class="stats-card">
                <h3>Daily Coding Streak</h3>
                <div class="streak-info">
                    <div class="streak-days">
                        5 <span>Days</span>
                    </div>
                    <span class="streak-label">60% to 1 week goal</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-inner" style="width: 60%;"></div>
                </div>
            </div>
            
            <div class="stats-card">
                <h3>Performance Summary</h3>
                <div class="summary-stats">
                    <div class="stat-item">
                        <span class="value">42</span>
                        <span class="label">Problems Solved</span>
                    </div>
                    <div class="stat-item">
                        <span class="value">18h</span>
                        <span class="label">Time Coded (Week)</span>
                    </div>
                </div>
            </div>
            
            <div class="stats-card">
                <h3>Weekly Progress</h3>
                <div class="chart-container" id="chart-container">
                    <!-- Bars generated by JS -->
                    <div class="chart-bar" data-value="30" title="Mon">
                        <div class="bar-fill"></div>
                        <span class="bar-label">M</span>
                    </div>
                    <div class="chart-bar" data-value="50" title="Tue">
                        <div class="bar-fill"></div>
                        <span class="bar-label">T</span>
                    </div>
                    <div class="chart-bar" data-value="80" title="Wed">
                        <div class="bar-fill"></div>
                        <span class="bar-label">W</span>
                    </div>
                    <div class="chart-bar" data-value="20" title="Thu">
                        <div class="bar-fill"></div>
                        <span class="bar-label">T</span>
                    </div>
                    <div class="chart-bar" data-value="60" title="Fri">
                        <div class="bar-fill"></div>
                        <span class="bar-label">F</span>
                    </div>
                    <div class="chart-bar" data-value="90" title="Sat">
                        <div class="bar-fill"></div>
                        <span class="bar-label">S</span>
                    </div>
                    <div class="chart-bar" data-value="40" title="Sun">
                        <div class="bar-fill"></div>
                        <span class="bar-label">S</span>
                    </div>
                </div>
            </div>
            
            <!-- Removed redundant stats-buttons container as the only button is now in profile-card -->
        </aside>

    </main>

    <!-- 
      * ==============================================
      * F. TOAST NOTIFICATION
      * ==============================================
    -->
    <div class="toast" id="toast-notification">
        This is a toast!
    </div>

    <!-- 
      * ==============================================
      * G. PROFILE MODAL POPUP (નવું મોડલ)
      * ==============================================
    -->
    <div class="modal-overlay" id="profile-modal-overlay">
        <div class="profile-modal" id="profile-modal">
            <button class="modal-close-btn" id="modal-close-btn">&times;</button>
            
            <!-- 8.1. PROFILE VIEW -->
            <div class="profile-view">
                <div class="modal-content-header">
                    <div class="profile-img-container" style="width: 100px; height: 100px; margin-bottom: 1rem;">
                        <img src="https://placehold.co/100x100/436b95/ffffff?text=MS" alt="User Profile Picture" class="profile-img" id="modal-profile-img">
                        <span class="profile-status-dot"></span>
                    </div>
                    <h2 class="profile-name" id="modal-profile-name">Manthan Savaj</h2> 
                    <p class="profile-email" id="modal-email-display">m.vinzuda@gmail.com</p> <!-- Email in header -->
                </div>
                
                <ul class="modal-detail-list">
                    <li>
                        <i class="ph ph-envelope-simple"></i>
                        <span class="detail-label">Email:</span>
                        <span class="detail-value" id="modal-email">m.vinzuda@gmail.com</span>
                    </li>
                    <li>
                        <i class="ph ph-hash"></i>
                        <span class="detail-label">Total Problems:</span>
                        <span class="detail-value" id="modal-total-problems">150</span>
                    </li>
                    <li>
                        <i class="ph ph-check-square"></i>
                        <span class="detail-label">Solved Problems:</span>
                        <span class="detail-value" id="modal-total-solved">42</span>
                    </li>
                    <li>
                        <i class="ph ph-arrow-circle-up"></i>
                        <span class="detail-label">Rank:</span>
                        <span class="detail-value">#1,234 (Top 10%)</span>
                    </li>
                    <li>
                        <i class="ph ph-sparkle"></i>
                        <span class="detail-label">Total XP:</span>
                        <span class="detail-value">8,500 XP</span>
                    </li>
                </ul>
                
                <button class="btn btn-primary" style="width: 100%; margin-top: 2rem;" id="edit-profile-btn">
                    <i class="ph ph-pencil-simple"></i>
                    Edit Profile
                </button>
            </div>
            
            <!-- 8.2. EDIT VIEW (Now hidden/shown using simple display toggle) -->
            <div class="edit-view">
                <h2 class="edit-title">Edit Profile</h2>

                <div class="form-group">
                    <label for="edit-name">Name</label>
                    <input type="text" id="edit-name" placeholder="Enter Your Name">
                </div>
                
                <div class="form-group">
                    <label for="edit-email">Email</label>
                    <input type="email" id="edit-email" placeholder="Enter Your Email">
                </div>

                <div class="form-group">
                    <label for="edit-initials">Initials (max 2 characters)</label>
                    <input type="text" id="edit-initials" maxlength="2" placeholder="Ex: MS">
                </div>
                
                <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 2rem;">
                    Avatar text will update based on initials.
                </p>

                <div class="form-actions">
                    <button class="btn btn-secondary" style="flex: 1;" id="cancel-edit-btn">
                        Cancel
                    </button>
                    <button class="btn btn-primary" style="flex: 1;" id="save-profile-btn">
                        Save Changes
                    </button>
                </div>
            </div>

        </div>
    </div>
    
    <!-- *==============================================
      * H. EMBEDDED JAVASCRIPT
      * ==============================================
    -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Get All Elements ---
            const body = document.body;
            const themeToggle = document.getElementById('theme-toggle');
            const navUserAvatarEl = document.getElementById('nav-user-avatar');
            const problemList = document.getElementById('problem-list');
            const consoleHeader = document.getElementById('console-header');
            const consoleContent = document.getElementById('console-content');
            const runBtn = document.getElementById('run-btn');
            const submitBtn = document.getElementById('submit-btn');
            const toastEl = document.getElementById('toast-notification');
            const codeEditor = document.getElementById('code-editor');
            const lineNumbersEl = document.getElementById('line-numbers');
            const chartContainer = document.getElementById('chart-container');
            const filterButtonsContainer = document.querySelector('.filter-buttons');
            const viewProfileBtn = document.getElementById('view-profile-btn');
            const languageSelectEl = document.getElementById('language-select');
            
            // --- Profile Elements (Sidebar) ---
            const profileNameEl = document.getElementById('profile-name');
            const profileEmailEl = document.getElementById('profile-email');
            const totalSolvedEl = document.getElementById('total-solved');
            const totalProblemsEl = document.getElementById('total-problems');
            const profileImgEl = document.getElementById('profile-img');

            // --- Modal Elements ---
            const profileModalEl = document.getElementById('profile-modal');
            const modalOverlay = document.getElementById('profile-modal-overlay');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalProfileName = document.getElementById('modal-profile-name');
            const modalEmailDisplay = document.getElementById('modal-email-display'); // Email in header
            const modalEmail = document.getElementById('modal-email');
            const modalTotalSolved = document.getElementById('modal-total-solved');
            const modalTotalProblems = document.getElementById('modal-total-problems');
            const modalProfileImg = document.getElementById('modal-profile-img');

            // --- NEW: Edit Mode Elements ---
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const saveProfileBtn = document.getElementById('save-profile-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const editNameInput = document.getElementById('edit-name');
            const editEmailInput = document.getElementById('edit-email');
            const editInitialsInput = document.getElementById('edit-initials');

            // --- User and Problem Data ---
            let userData = { // Changed to 'let' to allow updates
                name: 'Manthan Vinzuda', 
                email: 'm.vinzuda@gmail.com', // ** Email Updated **
                solved: 42,
                total: 150,
                initials: 'MV', 
                imageUrl: 'https://placehold.co/80x80/436b95/ffffff?text=MV', 
            };
            
            const problems = [
                { id: 1, title: 'Two Sum (The Classic)', difficulty: 'Easy', solved: true, tags: ['Array', 'Hash Table'] },
                { id: 2, title: 'Add Two Numbers', difficulty: 'Medium', solved: true, tags: ['Linked List', 'Math'] },
                { id: 3, title: 'Longest Substring Without Repeating...', difficulty: 'Medium', solved: false, tags: ['String', 'Sliding Window'] },
                { id: 4, title: 'Median of Two Sorted Arrays', difficulty: 'Hard', solved: false, tags: ['Array', 'Binary Search'] },
                { id: 5, title: 'Valid Parentheses', difficulty: 'Easy', solved: true, tags: ['Stack', 'String'] },
                { id: 6, title: 'Merge k Sorted Lists', difficulty: 'Hard', solved: false, tags: ['Heap', 'Linked List'] },
                { id: 7, title: 'Reverse Linked List', difficulty: 'Easy', solved: false, tags: ['Linked List'] },
                { id: 8, title: 'Maximum Subarray', difficulty: 'Medium', solved: true, tags: ['Array', 'DP'] },
            ];

            // --- Code Templates for Two Sum ---
            const codeTemplates = {
                python: 
`# Two Sum Solution Template (Python)
def twoSum(nums, target):
    """
    Given an array of integers nums and an integer target,
    return indices of the two numbers such that they add up to target.
    """
    seen = {}
    for i, num in enumerate(nums):
        complement = target - num
        if complement in seen:
            return [seen[complement], i]
        seen[num] = i
    return []`,
                javascript: 
`// Two Sum Solution Template (JavaScript)
/**
 * @param {number[]} nums
 * @param {number} target
 * @return {number[]}
 */
const twoSum = (nums, target) => {
    const seen = new Map();
    for (let i = 0; i < nums.length; i++) {
        const num = nums[i];
        const complement = target - num;
        if (seen.has(complement)) {
            return [seen.get(complement), i];
        }
        seen.set(num, i);
    }
    return [];
};`,
                cpp: 
`// Two Sum Solution Template (C++)
#include <vector>
#include <unordered_map>
#include <iostream>

using namespace std;

class Solution {
public:
    vector<int> twoSum(vector<int>& nums, int target) {
        unordered_map<int, int> seen;
        for (int i = 0; i < nums.size(); ++i) {
            int complement = target - nums[i];
            if (seen.count(complement)) {
                return {seen[complement], i};
            }
            seen[nums[i]] = i;
        }
        // No solution found
        return {}; 
    }
};`,
                java: 
`// Two Sum Solution Template (Java)
import java.util.HashMap;

class Solution {
    public int[] twoSum(int[] nums, int target) {
        HashMap<Integer, Integer> seen = new HashMap<>();
        for (int i = 0; i < nums.length; i++) {
            int complement = target - nums[i];
            if (seen.containsKey(complement)) {
                return new int[] { seen.get(complement), i };
            }
            seen.put(nums[i], i);
        }
        // No solution found
        return new int[0];
    }
}`
            };


            // --- Initialize/Update All Profile Details in UI (સબમિટ પછી પણ આ ફંક્શન કોલ થશે) ---
            function updateProfileUI() {
                const initials = userData.initials.toUpperCase().slice(0, 2);
                const displayName = `${userData.name}`; 
                const displayEmail = `${userData.email}`; // ** Email formatting for bold **
                
                // 1. Sidebar/Main UI updates
                profileNameEl.textContent = displayName;
                profileEmailEl.textContent = displayEmail;
                totalSolvedEl.textContent = userData.solved;
                totalProblemsEl.textContent = userData.total;
                
                // Update avatar everywhere
                const newAvatarUrl = `https://placehold.co/80x80/436b95/ffffff?text=${initials}`;
                
                profileImgEl.src = newAvatarUrl;
                navUserAvatarEl.src = `https://placehold.co/36x36/caa855/ffffff?text=${initials}`;

                // 2. Modal updates (Ensuring all modal fields reflect current user data)
                modalProfileName.textContent = displayName;
                modalEmailDisplay.textContent = displayEmail; // Email in header
                modalEmail.textContent = displayEmail;
                modalTotalSolved.textContent = userData.solved;
                modalTotalProblems.textContent = userData.total;
                modalProfileImg.src = `https://placehold.co/100x100/436b95/ffffff?text=${initials}`;
                
                // Set default values in Edit form when opening modal
                editNameInput.placeholder = userData.name; 
                editInitialsInput.placeholder = userData.initials;
                
            }
            
            // Initial call
            updateProfileUI();


            // --- 1. Theme Toggling & Local Storage ---
            const currentTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (currentTheme) {
                body.dataset.theme = currentTheme;
            } else if (prefersDark) {
                body.dataset.theme = 'dark';
                localStorage.setItem('theme', 'dark');
            } else {
                body.dataset.theme = 'light';
            }

            themeToggle.addEventListener('click', () => {
                const newTheme = body.dataset.theme === 'light' ? 'dark' : 'light';
                body.dataset.theme = newTheme;
                localStorage.setItem('theme', newTheme);
            });

            // --- 2. Filter and Render Problems ---

            function createProblemCard(problem) {
                const solvedClass = problem.solved ? 'solved' : '';
                const solvedIcon = problem.solved ? '<i class="ph-fill ph-check-circle"></i>' : '<i class="ph ph-circle"></i>';
                const tagHtml = problem.tags.map(tag => `<span class="tag">${tag}</span>`).join('');
                
                const selectedClass = problem.id === 1 ? 'selected' : '';

                return `
                    <div class="problem-card ${selectedClass}" data-id="${problem.id}" data-difficulty="${problem.difficulty}">
                        <div class="problem-card-header">
                            <h3>${problem.id}. ${problem.title}</h3>
                            <span class="problem-status ${solvedClass}">${solvedIcon}</span>
                        </div>
                        <div class="problem-card-footer">
                            <span class="difficulty-badge difficulty-${problem.difficulty.toLowerCase()}">${problem.difficulty}</span>
                            <div class="problem-tags">${tagHtml}</div>
                        </div>
                    </div>
                `;
            }

            function renderProblems(filter = 'All') {
                const filterUpper = filter.charAt(0).toUpperCase() + filter.slice(1);
                const filteredProblems = problems.filter(p => 
                    filter === 'All' || p.difficulty === filterUpper
                );

                if (filteredProblems.length === 0) {
                    problemList.innerHTML = '<p style="padding: 1rem; color: var(--text-muted);">No problems found for this difficulty level.</p>';
                    return;
                }
                
                problemList.innerHTML = filteredProblems.map(createProblemCard).join('');
            }
            
            // Event listener for filter buttons
            filterButtonsContainer.addEventListener('click', (e) => {
                const button = e.target.closest('.btn-filter');
                if (!button) return;

                filterButtonsContainer.querySelectorAll('.btn-filter').forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');

                const filter = button.textContent;
                renderProblems(filter);
            });
            
            // Initial load: render all problems.
            renderProblems('All');


            // --- 3. Problem Card Selection (Simulated) ---
            problemList.addEventListener('click', (e) => {
                const card = e.target.closest('.problem-card');
                if (!card) return;
                
                problemList.querySelectorAll('.problem-card.selected').forEach(selectedCard => {
                    selectedCard.classList.remove('selected');
                });
                
                card.classList.add('selected');
            });


            // --- 4. Language Selector and Code Update ---
            function setEditorCode(language) {
                if (codeTemplates[language]) {
                    codeEditor.value = codeTemplates[language].trim();
                    updateLineNumbers();
                }
            }

            languageSelectEl.addEventListener('change', (e) => {
                const selectedLanguage = e.target.value;
                showToast(`Language switched to ${selectedLanguage.toUpperCase()}`, 'info');
                setEditorCode(selectedLanguage);
            });


            // --- 5. Profile Modal Logic (પ્રોફાઇલ મોડલ લોજિક) ---

            // --- NEW: Edit Mode Functions ---
            function toggleEditMode(isEditing) {
                if (isEditing) {
                    // Populate form fields with current data
                    editNameInput.value = userData.name; 
                    editEmailInput.value = userData.email;
                    editInitialsInput.value = userData.initials;
                    profileModalEl.classList.add('edit-mode');
                    // Focus on the first input field
                    setTimeout(() => editNameInput.focus(), 350); 
                } else {
                    profileModalEl.classList.remove('edit-mode');
                }
            }

            function saveProfile() {
                let newName = editNameInput.value.trim();
                const newEmail = editEmailInput.value.trim();
                const newInitials = editInitialsInput.value.trim().toUpperCase().slice(0, 2);

                // --- Validation ---
                if (!newName || newName.length < 3) {
                    showToast("Name must be at least 3 characters.", "error", 2500);
                    return;
                }
                // Basic email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!newEmail || !emailRegex.test(newEmail)) {
                    showToast("Please enter a valid email address.", "error", 2500);
                    return;
                }
                if (!newInitials || newInitials.length === 0) {
                    showToast("Initials are required for the avatar.", "error", 2500);
                    return;
                }
                // --- End Validation ---
                
                // Update userData with clean name
                userData.name = newName; 
                userData.email = newEmail;
                userData.initials = newInitials;

                // Update UI elements
                updateProfileUI();
                
                showToast("Profile updated successfully!", "success");
                toggleEditMode(false); // Switch back to view mode
            }

            function openModal() {
                modalOverlay.classList.add('show');
                body.style.overflow = 'hidden';
                toggleEditMode(false); // Always start in view mode when opening
            }
            
            function closeModal() {
                modalOverlay.classList.remove('show');
                body.style.overflow = '';
            }

            // Button Event Listeners
            viewProfileBtn.addEventListener('click', openModal);
            navUserAvatarEl.addEventListener('click', openModal);
            modalCloseBtn.addEventListener('click', closeModal);
            
            editProfileBtn.addEventListener('click', () => toggleEditMode(true)); // Open Edit Mode
            cancelEditBtn.addEventListener('click', () => toggleEditMode(false)); // Cancel Edit
            saveProfileBtn.addEventListener('click', saveProfile); // Save Profile
            
            // Close modal via overlay click
            modalOverlay.addEventListener('click', (e) => {
                // Check if the click target is the overlay AND the modal is NOT in edit mode (to prevent accidental closing while editing)
                if (e.target === modalOverlay && !profileModalEl.classList.contains('edit-mode')) {
                    closeModal();
                }
            });
            
            // Close modal via ESC key
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modalOverlay.classList.contains('show')) {
                    if (profileModalEl.classList.contains('edit-mode')) {
                         // If in edit mode, cancel edit first
                        toggleEditMode(false); 
                    } else {
                        // If in view mode, close modal
                        closeModal();
                    }
                }
            });


            // --- 6. Console Toggling, Toast, Run/Submit, etc. (Existing Logic) ---
            consoleHeader.addEventListener('click', () => {
                consoleContent.classList.toggle('collapsed');
            });
            
            let toastTimer;
            function showToast(message, type = 'info', duration = 3000) {
                clearTimeout(toastTimer);
                toastEl.textContent = message;
                toastEl.className = 'toast show';
                if (type === 'success') {
                    toastEl.classList.add('success');
                } else if (type === 'error') {
                    toastEl.classList.add('error');
                    toastEl.style.backgroundColor = 'var(--difficulty-hard)'; // Ensure error toast is red/hard color
                } else {
                    toastEl.style.backgroundColor = 'var(--primary-blue)';
                }
                
                toastTimer = setTimeout(() => {
                    toastEl.classList.remove('show');
                }, duration);
            }

            runBtn.addEventListener('click', () => {
                runBtn.classList.add('loading');
                consoleContent.classList.remove('collapsed');
                consoleContent.innerHTML = '<div class="output-line">Running test cases...</div>';

                setTimeout(() => {
                    runBtn.classList.remove('loading');
                    showToast('Code Executed', 'info');
                    consoleContent.innerHTML = `
                        <div class="output-line success">[Success] Test Case 1 passed.</div>
                        <div class="output-line success">[Success] Test Case 2 passed.</div>
                        <div class="output-line error">[Failed] Test Case 3: Input [3,3], target 6</div>
                        <div class="output-line error">&nbsp;&nbsp;Expected: [0,1], Got: [0,0]</div>
                    `;
                    consoleContent.scrollTop = consoleContent.scrollHeight;
                }, 1500);
            });

            submitBtn.addEventListener('click', () => {
                submitBtn.classList.add('loading');
                consoleContent.classList.remove('collapsed');
                consoleContent.innerHTML = '<div class="output-line">Submitting and running all test cases...</div>';
                
                setTimeout(() => {
                    submitBtn.classList.remove('loading');
                    if (Math.random() > 0.5) {
                        showToast('Accepted!', 'success');
                        consoleContent.innerHTML = `
                            <div class="output-line success">[Accepted]</div>
                            <div class="output-line">Runtime: 88 ms, faster than 75.30%</div>
                            <div class="output-line">Memory: 15.2 MB, less than 90.10%</div>
                        `;
                    } else {
                        showToast('Wrong Answer', 'error');
                        consoleContent.innerHTML = `
                            <div class="output-line error">[Wrong Answer]</div>
                            <div class="output-line">Test Case 14/55 failed.</div>
                            <div class="output-line">Input: [1,2,3,4,5], target 10</div>
                            <div class="output-line error">Expected: [], Got: [0,4]</div>
                        `;
                    }
                    consoleContent.scrollTop = consoleContent.scrollHeight;
                }, 2000);
            });

            // --- 7. Code Editor Line Numbers & Scroll Sync ---
            function updateLineNumbers() {
                const lineCount = codeEditor.value.split('\n').length;
                let lineHtml = '';
                for (let i = 0; i < lineCount; i++) {
                    lineHtml += `<span></span>`; // Uses CSS counter
                }
                lineNumbersEl.innerHTML = lineHtml;
                lineNumbersEl.scrollTop = codeEditor.scrollTop;
            }

            codeEditor.addEventListener('input', updateLineNumbers);
            codeEditor.addEventListener('scroll', () => {
                lineNumbersEl.scrollTop = codeEditor.scrollTop;
            }); 
        });
    </script>
</body>
</html>